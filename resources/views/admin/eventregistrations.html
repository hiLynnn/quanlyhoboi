<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản Lý Phiếu Đăng Ký</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>
    <!-- Thanh điều hướng -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <a class="navbar-brand" href="#">Quản Lý Phiếu Đăng Ký</a>
        <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav">
                <li class="nav-item"><a class="nav-link active" href="index.html">Trang Chủ</a></li>
                <li class="nav-item"><a class="nav-link" href="pool-management.html">Quản Lý Hồ Bơi</a></li>
                <li class="nav-item"><a class="nav-link" href="service-management.html">Quản Lý Dịch Vụ</a></li>
                <li class="nav-item"><a class="nav-link" href="service-management2.html">Quản Lý Dịch Vụ Của Hồ Bơi</a></li>
                <li class="nav-item"><a class="nav-link active" href="event-management.html">Quản Lý Sự Kiện</a></li>
                <li class="nav-item"><a class="nav-link" href="facility-management.html">Quản Lý Tiện Ích</a></li>
                <li class="nav-item"><a class="nav-link" href="eventregistrations.html">Quản Lý Phiếu Đăng Ký</a></li>
                <li class="nav-item"><a class="nav-link" href="infor-customer.html">Thông Tin Khách Hàng</a></li>
                <li class="nav-item"><a class="nav-link" href="review-management.html">Đánh Giá Khách Hàng</a></li>
                <li class="nav-item"><a class="nav-link" href="statistics.html">Thống kê</a></li>

            </ul>
            <ul class="navbar-nav ms-auto">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" id="adminDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <img src="img/admin.jpg" alt="Admin" class="rounded-circle" style="width: 30px; height: 30px; margin-right: 8px;">
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="adminDropdown">
                        <li><a class="dropdown-item" href="profile.html">Hồ Sơ</a></li>
                        <li><a class="dropdown-item text-danger" href="logout.html">Đăng Xuất</a></li>
                    </ul>
                </li>
            </ul>
        </div>
    </nav>

    <!-- Container -->
    <div class="container mt-5">
        <h2>Danh Sách Phiếu Đăng Ký</h2>

        <div class="mb-3">
            <input type="text" class="form-control" id="searchEvent" placeholder="Tìm kiếm sự kiện..." oninput="searchEvent()">
        </div>

        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>STT</th>
                    <th>Tên Người Dùng</th>
                    <th>Tên Sự Kiện</th>
                    <th>Ngày Đăng Ký</th>
                    <th>Trạng Thái</th>
                    <th>Thao Tác</th>
                </tr>
            </thead>
            <tbody id="registrationList">
                <!-- Dữ liệu sẽ được tải vào đây -->
            </tbody>
        </table>
    </div>

    <!-- Modal Xác Nhận Phiếu Đăng Ký -->
    <div class="modal fade" id="confirmModal" tabindex="-1" aria-labelledby="confirmModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="confirmModalLabel">Duyệt Phiếu Đăng Ký</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <p>Bạn có chắc chắn muốn duyệt phiếu đăng ký này?</p>
                    <p><strong id="confirmUserName"></strong></p>
                    <p><strong id="confirmEventName"></strong></p>
                    <p><strong id="confirmRegistrationDate"></strong></p>
                    <p><strong id="confirmStatus"></strong></p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-success" id="confirmBtn">Duyệt</button>
                    <button type="button" class="btn btn-danger" id="rejectBtn">Từ Chối</button>
                </div>
            </div>
        </div>
    </div>

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function () {
            let authToken = localStorage.getItem("authToken") || ""; // Token lấy từ localStorage
            let registrationData = [
                { id_ER: 43, id_user: 22, id_event: 10, create_at: '2025-03-20 14:12:08', status: 'pending', userName: 'Nguyễn Văn A', eventName: 'Sự Kiện A' },
                { id_ER: 44, id_user: 22, id_event: 7, create_at: '2025-03-20 15:16:29', status: 'pending', userName: 'Nguyễn Văn B', eventName: 'Sự Kiện B' }
            ];

            // Hàm hiển thị danh sách phiếu đăng ký
            function loadRegistrations() {
                let registrationList = registrationData.map((registration, index) => `
                    <tr>
                        <td>${index + 1}</td>
                        <td>${registration.userName}</td>
                        <td>${registration.eventName}</td>
                        <td>${registration.create_at}</td>
                        <td>${registration.status}</td>
                        <td>
                            <button class="btn btn-success btn-sm confirm-btn" data-id="${registration.id_ER}" data-status="${registration.status}" data-user-name="${registration.userName}" data-event-name="${registration.eventName}" data-create-at="${registration.create_at}">Duyệt</button>
                            <button class="btn btn-danger btn-sm reject-btn" data-id="${registration.id_ER}" data-status="${registration.status}" data-user-name="${registration.userName}" data-event-name="${registration.eventName}" data-create-at="${registration.create_at}">Từ Chối</button>
                        </td>
                    </tr>
                `).join('');
                $("#registrationList").html(registrationList);
            }

            // Hiển thị danh sách phiếu đăng ký khi tải trang
            loadRegistrations();

            // Xử lý Duyệt Phiếu Đăng Ký
            $(document).on('click', '.confirm-btn', function () {
                let registration = $(this).data();
                $("#confirmUserName").text(registration['userName']);
                $("#confirmEventName").text(registration['eventName']);
                $("#confirmRegistrationDate").text(registration['create-at']);
                $("#confirmStatus").text(registration['status']);

                // Khi duyệt, thay đổi trạng thái phiếu đăng ký
                $("#confirmBtn").click(function () {
                    // Giả sử bạn gửi request PUT/PATCH đến API
                    registration.status = 'confirmed';
                    alert(`Phiếu đăng ký của ${registration.userName} đã được duyệt!`);
                    $("#confirmModal").modal("hide");
                    loadRegistrations(); // Cập nhật lại danh sách phiếu đăng ký
                });

                // Hiển thị modal
                $("#confirmModal").modal("show");
            });

            // Xử lý Từ Chối Phiếu Đăng Ký
            $(document).on('click', '.reject-btn', function () {
                let registration = $(this).data();
                if (confirm(`Bạn có chắc chắn muốn từ chối phiếu đăng ký của ${registration['userName']}?`)) {
                    // Giả sử bạn gửi request PUT/PATCH đến API
                    registration.status = 'rejected';
                    alert(`Phiếu đăng ký của ${registration.userName} đã bị từ chối!`);
                    loadRegistrations(); // Cập nhật lại danh sách phiếu đăng ký
                }
            });
        });
    </script>
</body>

</html>
